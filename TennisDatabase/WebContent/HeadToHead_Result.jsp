<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page import="java.util.*" %>
<%@ page import="database.DBMS" %>
<%@ page import="utility.DbConnectUtil3" %>
<%@ page import="utility.AccessCounter3" %>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" charset="UTF-8" />
<link rel="stylesheet" type="text/css" href="css/Rainbow.css" />
<title>Head To Head</title>
	<img src="http://rainbow-engine.com/wp-content/uploads/2017/09/cropped-c8a03ed7.jpg" alt="" width="30%"/>
	<img src="http://rainbow-engine.com/wp-content/uploads/2017/09/cropped-c8a03ed7.jpg" alt="" width="30%"/>
	<img src="http://rainbow-engine.com/wp-content/uploads/2017/09/cropped-c8a03ed7.jpg" alt="" width="30%"/>
	<center>
		<h2 id="title">TENHTOHR</h2>
		<h3 id="subtitle">Head To Head Query Result Screen</h3>
		
		<%
		AccessCounter3 ac = new AccessCounter3();
		%>
		[ TENHTOHR画面のアクセスカウンター： <b><%=ac.GetAccessCount2("TENHTOHR")%></b> ]	
		<br /><br />	
	</center>
</head>
<body>
<table border="3" style="border-collapse: collapse">
<tr>
	<th>HtoH No.</th>
	<th>Tournament Year</th>
	<th>Tournament Name</th>
	<th>Tournament Round Name</th>
	<th>Win Name</th>
	<th>Win Seed</th>
	<th>Lose Name</th>
	<th>Lose Seed</th>
	<th>Match Scores</th>
</tr>
<%
Calendar cal8 = Calendar.getInstance();	System.out.println(cal8.getTime()+" : 008-Before Result Query");
//String select1 = "SELECT ROW_NUMBER() OVER(ORDER BY CONCAT(SUBSTR(TOURNEY_YEAR_ID,1,4),LPAD(TOURNEY_ORDER,3,0)) ASC) AS NO ,SUBSTR(TOURNEY_YEAR_ID,1,4) AS TOURNEY_YEAR ,TOURNEY_SLUG ,TOURNEY_ROUND_NAME ,ROUND_ORDER ,WIN_NAME ,WIN_SEED ,LOSE_NAME ,LOSE_SEED ,MATCH_SCORE_TIEBREAKS FROM (     SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX     FROM MATCH_SCORES_1877_1967     WHERE WIN_PLAYER_ID IN ('d643','f324')     AND LOSE_PLAYER_ID IN ('d643','f324')     UNION ALL     SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX     FROM MATCH_SCORES_1968_1990     WHERE WIN_PLAYER_ID IN ('d643','f324')     AND LOSE_PLAYER_ID IN ('d643','f324')     UNION ALL     SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX     FROM MATCH_SCORES_1991_2016     WHERE WIN_PLAYER_ID IN ('d643','f324')     AND LOSE_PLAYER_ID IN ('d643','f324')     UNION ALL     SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX     FROM MATCH_SCORES_2017     WHERE WIN_PLAYER_ID IN ('d643','f324')     AND LOSE_PLAYER_ID IN ('d643','f324') ) MATCH_SCORES ORDER BY SUBSTR(TOURNEY_YEAR_ID,1,4),TO_NUMBER(TOURNEY_ORDER)";
String pl1 = request.getParameter("q_hplayer1");
String pl2 = request.getParameter("q_hplayer2");
String plfix = "'"+pl1+"','"+pl2+"'";
String select1 = "SELECT ROW_NUMBER() OVER(ORDER BY CONCAT(SUBSTR(TOURNEY_YEAR_ID,1,4),LPAD(TOURNEY_ORDER,3,0)) ASC) AS NO, SUBSTR(TOURNEY_YEAR_ID,1,4) AS TOURNEY_YEAR ,TOURNEY_SLUG ,TOURNEY_ROUND_NAME ,ROUND_ORDER ,WIN_NAME ,WIN_SEED ,LOSE_NAME ,LOSE_SEED ,MATCH_SCORE_TIEBREAKS FROM ( SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX FROM MATCH_SCORES_1877_1967 WHERE WIN_NAME IN (";
String select2 = ") AND LOSE_NAME IN (";
String select3 = ") UNION ALL SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX FROM MATCH_SCORES_1968_1990 WHERE WIN_NAME IN (";
String select4 = ") AND LOSE_NAME IN (";
String select5 = ") UNION ALL SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX FROM MATCH_SCORES_1991_2016 WHERE WIN_NAME IN (";
String select6 = ") AND LOSE_NAME IN (";
String select7 = ") UNION ALL SELECT TOURNEY_YEAR_ID ,CAST(TOURNEY_ORDER AS VARCHAR2(9 CHAR)) AS TOURNEY_ORDER ,CAST(TOURNEY_SLUG AS VARCHAR2(18 CHAR)) AS TOURNEY_SLUG ,CAST(TOURNEY_URL_SUFFIX AS VARCHAR2(55 CHAR)) AS TOURNEY_URL_SUFFIX ,CAST(TOURNEY_ROUND_NAME AS VARCHAR2(20 CHAR)) AS TOURNEY_ROUND_NAME ,ROUND_ORDER ,MATCH_ORDER ,CAST(WIN_NAME AS VARCHAR2(34 CHAR)) AS WIN_NAME ,WIN_PLAYER_ID ,CAST(WIN_SLUG AS VARCHAR2(34 CHAR)) AS WIN_SLUG ,CAST(LOSE_NAME AS VARCHAR2(34 CHAR)) AS LOSE_NAME ,LOSE_PLAYER_ID ,CAST(LOSE_SLUG AS VARCHAR2(34 CHAR)) AS LOSE_SLUG ,CAST(WIN_SEED AS VARCHAR2(5 CHAR)) AS WIN_SEED ,CAST(LOSE_SEED AS VARCHAR2(5 CHAR)) AS LOSE_SEED ,CAST(MATCH_SCORE_TIEBREAKS AS VARCHAR2(29 CHAR)) AS MATCH_SCORE_TIEBREAKS ,WIN_SETS_WON ,LOSE_SETS_WON ,WIN_GAMES_WON ,LOSE_GAMES_WON ,WIN_TIEBREAKS_WON ,LOSE_TIEBREAKS_WON ,CAST(MATCH_ID AS VARCHAR2(21 CHAR)) AS MATCH_ID ,CAST(MATCH_STATS_URL_SUFFIX AS VARCHAR2(38 CHAR)) AS MATCH_STATS_URL_SUFFIX FROM MATCH_SCORES_2017 WHERE WIN_NAME IN (";
String select8 = ") AND LOSE_NAME IN (";
String select9 = ") ) MATCH_SCORES ORDER BY SUBSTR(TOURNEY_YEAR_ID,1,4),TO_NUMBER(TOURNEY_ORDER)";
String select_fix = select1 +plfix +select2 +plfix +select3 +plfix +select4 +plfix +select5 +plfix +select6 +plfix +select7 +plfix +select8 +plfix +select9;
DbConnectUtil3 db = new DbConnectUtil3();
Calendar cal9 = Calendar.getInstance();	System.out.println(cal9.getTime()+" : 009-After create DbConnUtil instance");
db.conn = db.DbConnect();
db.stmt = db.DbStatement();
Calendar cal10 = Calendar.getInstance(); System.out.println(cal10.getTime()+" : 010-After Create Statement");
db.rs = db.DbQuery(select_fix);
Calendar cal11 = Calendar.getInstance(); System.out.println(cal11.getTime()+" : 011-After Create Execute Query");
while(db.rs.next()){
	%>
	<tr>
		<td><%=db.rs.getString("NO") %></td>
		<td><%=db.rs.getString("TOURNEY_YEAR") %></td>
		<td><%=db.rs.getString("TOURNEY_SLUG") %></td>
		<td><%=db.rs.getString("TOURNEY_ROUND_NAME") %></td>
		<td><%=db.rs.getString("WIN_NAME") %></td>
		<td><%=db.rs.getString("WIN_SEED") %></td>
		<td><%=db.rs.getString("LOSE_NAME") %></td>
		<td><%=db.rs.getString("LOSE_SEED") %></td>
		<td><%=db.rs.getString("MATCH_SCORE_TIEBREAKS") %></td>
	</tr>
	<%
}
db.DbClose();
%>
</table>
</br>
<a href="HeadToHead_Query_v2.jsp" >＞Head To Head Query Screen V2に戻る</a></br></br>
<br/>
<a href="HeadToHead_Query.jsp" >＞Head To Head Query Screenに戻る</a></br></br>
</body>
</html>
